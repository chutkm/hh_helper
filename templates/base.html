<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система отбора резюме</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* Стили для выпадающего списка */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 200px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        .dropdown-content label {
            display: block;
            padding: 8px 16px;
            cursor: pointer;
        }
        .dropdown-content label:hover {
            background-color: #ddd;
        }
        .selected-display {
            margin-top: 5px;
            font-size: 14px;
            color: #555;
        }

        /* Стили для прогресс-бара */
        .progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin-top: 10px;
            height: 20px;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background-color: #4caf50;
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Система отбора резюме</h1>
    <div class="container">
        <!-- Левая панель: Форма фильтров -->
        <div class="left-panel">
            <h2>Фильтры</h2>
            <form id="filter-form">
                <!-- Должность -->
                <div class="form-group">
                    <label>Должность:</label>
                    <input type="text" id="position" placeholder="Введите должность">
                </div>
                <!-- Уровень компетентности -->
                <div class="form-group">
                    <label for="competency_level">Уровень компетентности:</label>
                    <select id="competency_level" name="competency_level">
                        <option value="">Выберите уровень</option>
                        <option value="intern">Intern</option>
                        <option value="junior">Junior</option>
                        <option value="middle">Middle</option>
                        <option value="senior">Senior</option>
                    </select>
                </div>
                <!-- Тип занятости -->
                <div class="form-group">
                    <label for="employment_type">Тип занятости:</label>
                    <select id="employment_type" name="employment_type">
                        <option value="">Выберите тип</option>
                        <option value="full">Полная занятость</option>
                        <option value="part">Частичная занятость</option>
                        <option value="project">Проектная деятельность</option>
                        <option value="internship">Стажировка</option>
                    </select>
                </div>
                <!-- Образование -->
                <div class="form-group custom-dropdown">
                    <label>Образование:</label>
                    <div class="dropdown">
                        <button class="dropbtn education-btn" type="button">
                            Выберите уровни
                        </button>
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="education" value="higher_full"> Высшее полное</label>
                            <label><input type="checkbox" name="education" value="higher"> Высшее</label>
                            <label><input type="checkbox" name="education" value="secondary"> Среднее профессиональное</label>
                        </div>
                        <div class="selected-display"></div>
                    </div>
                </div>
                <!-- Опыт работы -->
                <div class="form-group">
                    <label>Опыт работы:</label>
                    <input type="number" id="experience" min="0" max="50" step="1" value="0">
                    <span class="counter-label">лет</span>
                </div>
                <!-- Ключевые навыки -->
                <div class="form-group custom-dropdown">
                    <label>Ключевые навыки:</label>
                    <div class="dropdown">
                        <button class="dropbtn skills-btn" type="button">
                            Выберите навыки
                        </button>
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="skills" value="python">Python</label>
                            <label><input type="checkbox" name="skills" value="java">Java</label>
                            <label><input type="checkbox" name="skills" value="javascript">JavaScript</label>
                            <label><input type="checkbox" name="skills" value="cpp">C++</label>
                            <label><input type="checkbox" name="skills" value="csharp">C#</label>
                            <label><input type="checkbox" name="skills" value="php">PHP</label>
                            <label><input type="checkbox" name="skills" value="ruby">Ruby</label>
                            <label><input type="checkbox" name="skills" value="swift">Swift</label>
                            <label><input type="checkbox" name="skills" value="kotlin">Kotlin</label>
                            <label><input type="checkbox" name="skills" value="go">Go</label>
                            <label><input type="checkbox" name="skills" value="rust">Rust</label>
                            <label><input type="checkbox" name="skills" value="react">React</label>
                            <label><input type="checkbox" name="skills" value="angular">Angular</label>
                            <label><input type="checkbox" name="skills" value="vue">Vue.js</label>
                            <label><input type="checkbox" name="skills" value="tensorflow">TensorFlow</label>
                            <label><input type="checkbox" name="skills" value="pytorch">PyTorch</label>
                            <label><input type="checkbox" name="skills" value="pandas">Pandas</label>
                            <label><input type="checkbox" name="skills" value="numpy">NumPy</label>
                            <label><input type="checkbox" name="skills" value="sql">SQL</label>
                            <label><input type="checkbox" name="skills" value="postgresql">PostgreSQL</label>
                            <label><input type="checkbox" name="skills" value="mysql">MySQL</label>
                            <label><input type="checkbox" name="skills" value="mongodb">MongoDB</label>
                            <label><input type="checkbox" name="skills" value="nosql">NoSQL</label>
                            <label><input type="checkbox" name="skills" value="docker">Docker</label>
                            <label><input type="checkbox" name="skills" value="kubernetes">Kubernetes</label>
                            <label><input type="checkbox" name="skills" value="aws">AWS</label>
                            <label><input type="checkbox" name="skills" value="azure">Azure</label>
                            <label><input type="checkbox" name="skills" value="gcp">Google Cloud</label>
                            <label><input type="checkbox" name="skills" value="git">Git</label>
                            <label><input type="checkbox" name="skills" value="linux">Linux</label>
                            <label><input type="checkbox" name="skills" value="ml">ML</label>
                            <label><input type="checkbox" name="skills" value="nlp">NLP</label>
                            <label><input type="checkbox" name="skills" value="blockchain">Blockchain</label>
                            <label><input type="checkbox" name="skills" value="devops">DevOps</label>
                            <label><input type="checkbox" name="skills" value="api">API</label>
                        </div>
                        <div class="selected-display"></div>
                    </div>
                </div>
                <!-- Уровень английского -->
                <div class="form-group custom-dropdown">
                    <label>Уровень английского:</label>
                    <div class="dropdown">
                        <button class="dropbtn english-btn" type="button">
                            Выберите уровни
                        </button>
                        <div class="dropdown-content">
                            <label><input type="checkbox" name="english_level" value="any"> Не важен</label>
                            <label><input type="checkbox" name="english_level" value="a1"> A1</label>
                            <label><input type="checkbox" name="english_level" value="a2"> A2</label>
                            <label><input type="checkbox" name="english_level" value="b1"> B1</label>
                            <label><input type="checkbox" name="english_level" value="b2"> B2</label>
                            <label><input type="checkbox" name="english_level" value="c1"> C1</label>
                            <label><input type="checkbox" name="english_level" value="c2"> C2</label>
                        </div>
                        <div class="selected-display"></div>
                    </div>
                </div>
                <!-- Особые требования -->
                <div class="form-group">
                    <label>Особые требования:</label>
                    <input type="text" id="special_requirements" placeholder="Дополнительные условия">
                </div>
                <button type="submit">Применить фильтры</button>
                <button type="reset" id="reset-filters">Сброс</button>
            </form>
        </div>
        <!-- Правая панель: Загрузка резюме и результаты -->
        <div class="right-panel">
            <h2>Загрузка резюме</h2>
            <div class="upload-section">
                <label for="resume-upload">Загрузите PDF-файлы:</label>
                <input type="file" id="resume-upload" multiple accept=".pdf">
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
                <div class="uploaded-files">
                    <h3>Загруженные файлы:</h3>
                    <ul id="uploaded-files-list"></ul>
                </div>
            </div>
            <div class="results-section">
                <h2>Результаты отбора</h2>
                <button id="show-ranking" class="ranking-btn">Показать рейтинг кандидатов</button>
                <ul id="results-list">
                    <!-- Результаты анализа будут здесь -->
                </ul>
            </div>
        </div>
    </div>
    <script>
        // Обработчик для кнопки "Показать рейтинг кандидатов"
        document.getElementById('show-ranking').addEventListener('click', () => {
            // Получаем значение должности из формы (если оно есть)
            const position = document.getElementById('position')?.value || 'Не указана';

            // Формируем URL для перехода на страницу /ranking
            const rankingUrl = `/ranking?position=${encodeURIComponent(position)}`;

            // Переходим на страницу /ranking
            window.location.href = rankingUrl;
        });
    </script>
    <script>
        // Логика для выпадающих списков
        document.querySelectorAll('.dropdown button').forEach(button => {
            const dropdownContent = button.nextElementSibling;
            const selectedDisplay = dropdownContent.nextElementSibling;

            // Открытие/закрытие выпадающего списка
            button.addEventListener('click', () => {
                dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
            });

            // Обработка выбора чекбоксов
            dropdownContent.addEventListener('change', (event) => {
                if (event.target.tagName === 'INPUT') {
                    const selectedOptions = Array.from(dropdownContent.querySelectorAll('input[type="checkbox"]:checked'))
                        .map(input => input.value);

                    // Обновляем текст кнопки
                    button.textContent = selectedOptions.length > 0 ? selectedOptions.join(', ') : 'Выберите';

                    // Обновляем отображение выбранных значений
                    selectedDisplay.textContent = selectedOptions.length > 0 ? `Выбрано: ${selectedOptions.join(', ')}` : '';
                }
            });
        });

        // Отправка данных на сервер через AJAX
        document.getElementById('filter-form').addEventListener('submit', function (event) {
            event.preventDefault(); // Предотвращаем стандартное поведение формы

            // Собираем данные с формы
            const position = document.getElementById('position').value;
            const competencyLevel = document.getElementById('competency_level').value;
            const employmentType = document.getElementById('employment_type').value;
            const education = Array.from(document.querySelectorAll('input[name="education"]:checked'))
                .map(checkbox => checkbox.value);
            const experience = document.getElementById('experience').value;
            const keySkills = Array.from(document.querySelectorAll('input[name="skills"]:checked'))
                .map(checkbox => checkbox.value);
            const englishLevel = Array.from(document.querySelectorAll('input[name="english_level"]:checked'))
                .map(checkbox => checkbox.value);
            const specialRequirements = document.getElementById('special_requirements').value;

            // Создаем объект с данными
            const formData = {
                position_name: position,
                competency_level: competencyLevel,
                employment_type: employmentType,
                education: education,
                work_experience: parseInt(experience),
                key_skills: keySkills,
                english_level: englishLevel.join(', ') || null,
                special_requirements: specialRequirements
            };

            // Отправляем данные на сервер через AJAX
            fetch('/add_position', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Ошибка:', error);
            });
        });

        // Обработка загрузки файлов
        document.getElementById('resume-upload').addEventListener('change', async function (event) {
            const files = event.target.files;
            if (!files.length) return;

            const progressBar = document.getElementById('progress-bar');
            const uploadedFilesList = document.getElementById('uploaded-files-list');
            uploadedFilesList.innerHTML = ''; // Очищаем список загруженных файлов

            const formData = new FormData();
            for (const file of files) {
                formData.append('files', file);
            }

            try {
                // Отправляем файлы на сервер
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // Обновляем интерфейс
                if (result.results) {
                    result.results.forEach(fileResult => {
                        const li = document.createElement('li');
                        li.textContent = `${fileResult.filename}: ${fileResult.status} - ${fileResult.message}`;
                        uploadedFilesList.appendChild(li);
                    });
                }

                alert('Файлы успешно загружены!');
            } catch (error) {
                console.error('Ошибка при загрузке файлов:', error);
                alert('Произошла ошибка при загрузке файлов.');
            } finally {
                // Сбрасываем прогресс-бар
                progressBar.style.width = '0%';
                progressBar.textContent = '';
            }
        });
    </script>
</body>
</html>